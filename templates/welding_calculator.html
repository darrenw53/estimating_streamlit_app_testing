<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welding Calculator</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; }
        .container { background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 800px; margin: auto; }
        h1, h2 { color: #333; }
        .weld-row { display: flex; align-items: center; margin-bottom: 10px; padding: 10px; border: 1px solid #e9ecef; border-radius: 4px; gap: 15px; }
        .weld-row label.main-label { flex-basis: 80px; font-weight: bold; }
        .weld-row select, .weld-row input[type="number"] { flex-grow: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        .actions a, input[type="submit"], button { margin-right: 10px; text-decoration: none; color: #fff; background-color: #007bff; padding: 10px 15px; border-radius: 4px; border:none; font-size:1em; cursor:pointer; }
        .nav-links a { margin-right: 10px; text-decoration: none; color: #fff; background-color: #6c757d; padding: 10px 15px; border-radius: 4px; display: inline-block; margin-bottom:20px; }
        .weld-options { display: flex; align-items: center; gap: 5px; }
        .weld-options label { font-weight: normal; margin-left: 2px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-links">
            <a href="{{ url_for('home') }}">Home</a>
            <a href="{{ url_for('view_estimate_summary') }}" style="background-color:#007bff;">View Main Estimate ({{ estimate_count }} entries)</a>
        </div>
        <h1>Welding Calculator</h1>
        <p>Add up to 50 weld entries. The calculated totals for time and wire weight will be added as a single entry to your main estimate.</p>
        
        <form action="{{ url_for('calculate_welding_route') }}" method="POST">
            <div id="weld-entries-container">
                <!-- JavaScript will add rows here -->
            </div>
            <button type="button" id="add-weld-row-btn">Add Weld Entry</button>
            <input type="submit" value="Calculate & Add to Main Estimate" style="background-color: #28a745;">
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('weld-entries-container');
            const addBtn = document.getElementById('add-weld-row-btn');
            let rowCount = 0;
            const maxRows = 50;
            const weldSizes = {{ weld_size_options|tojson }};

            function addWeldRow() {
                if (rowCount >= maxRows) {
                    alert('You have reached the maximum of 50 weld entries.');
                    return;
                }
                rowCount++;

                const rowDiv = document.createElement('div');
                rowDiv.className = 'weld-row';
                
                const rowLabel = document.createElement('label');
                rowLabel.className = 'main-label';
                rowLabel.textContent = `Weld #${rowCount}:`;
                
                const sizeSelect = document.createElement('select');
                sizeSelect.name = `weld_size_${rowCount}`;
                let option = document.createElement('option');
                option.value = "";
                option.textContent = "-- Select Weld Size --";
                sizeSelect.appendChild(option);
                weldSizes.forEach(function(size) {
                    option = document.createElement('option');
                    option.value = size;
                    option.textContent = size;
                    sizeSelect.appendChild(option);
                });

                const lengthInput = document.createElement('input');
                lengthInput.type = 'number';
                lengthInput.name = `weld_length_${rowCount}`;
                lengthInput.placeholder = "Length (inches)";
                lengthInput.step = "any";
                lengthInput.min = "0";

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'weld-options';

                const preheatCheckbox = document.createElement('input');
                preheatCheckbox.type = 'checkbox';
                preheatCheckbox.name = `preheat_${rowCount}`;
                preheatCheckbox.id = `preheat_${rowCount}`;
                const preheatLabel = document.createElement('label');
                preheatLabel.htmlFor = `preheat_${rowCount}`;
                preheatLabel.textContent = "Pre-heat?";

                const cjpCheckbox = document.createElement('input');
                cjpCheckbox.type = 'checkbox';
                cjpCheckbox.name = `cjp_${rowCount}`;
                cjpCheckbox.id = `cjp_${rowCount}`;
                const cjpLabel = document.createElement('label');
                cjpLabel.htmlFor = `cjp_${rowCount}`;
                cjpLabel.textContent = "CJP?";

                optionsDiv.appendChild(preheatCheckbox);
                optionsDiv.appendChild(preheatLabel);
                optionsDiv.appendChild(cjpCheckbox);
                optionsDiv.appendChild(cjpLabel);

                rowDiv.appendChild(rowLabel);
                rowDiv.appendChild(sizeSelect);
                rowDiv.appendChild(lengthInput);
                rowDiv.appendChild(optionsDiv);
                container.appendChild(rowDiv);
            }

            addBtn.addEventListener('click', addWeldRow);
            addWeldRow();
        });
    </script>
</body>
</html>
